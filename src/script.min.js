const backImage="assets/Blue_Question_Circle.svg",defaultMD="Coucou !\nHi !\n\n![](assets/perso_educajou.svg)\n\n![](assets/brigit_et_komit.png)\nBrigit & Komit\n";function handleURL(t,e){if(""!==t){let n=!(!e||!e.useCorsProxy);t.includes(".forge")&&(n=!1),t.startsWith("https://github.com")&&(n=!1,t=(t=t.replace("https://github.com","https://raw.githubusercontent.com")).replace("/blob/","/")),(t.startsWith("https://codimd")||t.startsWith("https://pad.numerique.gouv.fr/")||t.includes("hedgedoc")||t.includes("digipage"))&&(n=!1,t=-1===(t=t.replace("?edit","").replace("?both","").replace("?view","").replace(/#$/,"").replace(/\/$/,"")).indexOf("download")?t+"/download":t),!t.includes("framapad")&&!t.includes("digidoc")||t.endsWith("/export/txt")||(n=!1,t=t.replace(/\?.*/,"")+"/export/txt"),t=n?"https://corsproxy.io/?url="+t:t}return t}function getMarkdownFromURL(t){return fetch(t).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.text()}).catch(t=>(console.error("There has been a problem with your fetch operation:",t),defaultMD))}function getURLfromHash(){return handleURL(window.location.hash.substring(1))||""}const renderer={link(t,e,n){return marked.Renderer.prototype.link.call(this,t,e,n).replace("<a","<a target='_blank' rel='noreferrer' ")}};function parseMarkdown(t){const e=t.match(/^# (.*)/),n=e?e[1].trim():null,i=t.match(/^>\s*(.*)/gm),s=i?i.join("\n").trim():null,r=Math.max(e?t.indexOf(e[0])+e[0].length:0,i?t.indexOf(s)+s.length:0),o=t.slice(r).match(/^\s*\n*/),a=o?r+o[0].length:r,d=t.slice(a).replace(/\n\n+/g,"\n\n").trim().split("\n\n"),c=[];return d.forEach((t,e)=>{if(t.includes("\n")){const n=t.split("\n");c.push({content:n[0],id:e}),c.push({content:n[1],id:e})}else c.push({content:t,id:e})}),{cards:c,title:n,blockquote:s}}function duplicateUniqueCards(t){const e=t.reduce((t,e)=>(t[e.id]=(t[e.id]||0)+1,t),{}),n=t.filter(t=>1===e[t.id]);return t.concat(n)}let sound;async function main(){var t={init:function(t){this.game=document.querySelector(".game"),this.modal=document.querySelector(".modal"),this.overlay=document.querySelector(".modal-overlay"),this.restartButton=document.querySelector("button.restart"),this.cardsArray=duplicateUniqueCards(t),this.shuffleCards(this.cardsArray),this.setup()},shuffleCards:function(t){this.cards=this.shuffle(t)},setup:function(){this.html=this.buildHTML(),this.game.innerHTML=this.html,this.memoryCards=document.querySelectorAll(".card"),this.paused=!1,this.guess=null,this.binding(),textFit(document.querySelectorAll(".front"),{multiLine:!1})},binding:function(){var t=this;this.memoryCards.forEach(function(e){e.addEventListener("click",function(){t.cardClicked.call(t,e)})}),this.restartButton.addEventListener("click",function(){t.reset.call(t)})},cardClicked:function(t){var e=t,n=e.querySelector(".inside");const i=n.querySelector("div[data-audio-src]");if(sound&&(sound.pause(),sound.currentTime=0),i&&(sound=new Audio(i.getAttribute("data-audio-src")),sound.play()),n&&!this.paused&&!n.classList.contains("matched")&&!n.classList.contains("picked")){if(n.classList.add("picked"),this.guess)if(this.guess!=e.getAttribute("data-id")||e.classList.contains("picked")){this.guess=null,this.paused=!0;var s=this;setTimeout(function(){document.querySelectorAll(".picked").forEach(function(t){t.classList.remove("picked")}),s.paused=!1},600)}else document.querySelectorAll(".picked").forEach(function(t){t.classList.add("matched")}),this.guess=null;else this.guess=e.getAttribute("data-id");document.querySelectorAll(".matched").length==document.querySelectorAll(".card").length&&this.win()}},win:function(){this.paused=!0;var t=this;setTimeout(function(){t.showModal()},1e3)},showModal:function(){this.overlay.style.display="block",this.modal.style.display="block"},hideModal:function(){this.overlay.style.display="none",this.modal.style.display="none"},reset:function(){this.hideModal(),this.shuffleCards(this.cardsArray),this.setup(),this.game.style.display="block"},shuffle:function(t){for(var e,n,i=t.length;i>0;)n=Math.floor(Math.random()*i),e=t[--i],t[i]=t[n],t[n]=e;return t},buildHTML:function(){var t="";return this.cards.forEach(function(e){let n="";if(e.content.startsWith("audio:")){n=`<div data-audio-src="${e.content.replace("audio:","").trim()}">ðŸ”Š</div>`}else n=marked.parseInline(e.content);t+=`<div class="card" data-id="${e.id}"><div class="inside"><div class="front">${n}</div><div class="back"><img src="${backImage}" alt="" /></div></div></div>`}),t}};let e="";if(""===getURLfromHash()){e=defaultMD;const t=document.createElement("footer"),n=await getMarkdownFromURL("https://memory.forge.apps.education.fr/README.md");t.innerHTML=marked.parse(n),document.body.appendChild(t),document.body.classList.add("default")}else e=await getMarkdownFromURL(getURLfromHash());const n=parseMarkdown(e),i=n.cards;if(n.title){document.title=n.title;const t=document.createElement("h1");t.textContent=n.title,document.body.insertBefore(t,document.body.firstChild)}if(n.blockquote){const t=document.createElement("div");t.className="instructions",t.innerHTML=marked.parse(n.blockquote);const e=document.querySelector("h1");e?e.insertAdjacentElement("afterend",t):document.body.insertBefore(t,document.body.firstChild)}t.init(i)}marked.use({renderer:renderer}),main();