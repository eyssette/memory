const backImage="assets/Blue_Question_Circle.svg",defaultMD="\n# Memory\n\nCoucou !\nHi !\n\n![](assets/perso_educajou.svg)\n\n![](assets/brigit_et_komit.png)\nBrigit & Komit\n";function handleURL(e,t){if(""!==e){let s=!(!t||!t.useCorsProxy);e.includes(".forge")&&(s=!1),e.startsWith("https://github.com")&&(s=!1,e=(e=e.replace("https://github.com","https://raw.githubusercontent.com")).replace("/blob/","/")),(e.startsWith("https://codimd")||e.startsWith("https://pad.numerique.gouv.fr/")||e.includes("hedgedoc")||e.includes("digipage"))&&(s=!1,e=-1===(e=e.replace("?edit","").replace("?both","").replace("?view","").replace(/#$/,"").replace(/\/$/,"")).indexOf("download")?e+"/download":e),!e.includes("framapad")&&!e.includes("digidoc")||e.endsWith("/export/txt")||(s=!1,e=e.replace(/\?.*/,"")+"/export/txt"),e=s?"https://corsproxy.io/?url="+e:e}return e}function getMarkdownFromURL(e){return fetch(e).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()}).catch(e=>(console.error("There has been a problem with your fetch operation:",e),defaultMD))}function getURLfromHash(){return handleURL(window.location.hash.substring(1))||""}const renderer={link(e,t,s){return marked.Renderer.prototype.link.call(this,e,t,s).replace("<a","<a target='_blank' rel='noreferrer' ")}};function parseMarkdown(e){const t=e.replace(/#.*/g,"").replace(/\n\n+/g,"\n\n").trim().split("\n\n"),s=[];return t.forEach((e,t)=>{if(e.includes("\n")){const i=e.split("\n");s.push({content:i[0],id:t}),s.push({content:i[1],id:t})}else s.push({content:e,id:t})}),s}function duplicateUniqueCards(e){const t=e.reduce((e,t)=>(e[t.id]=(e[t.id]||0)+1,e),{}),s=e.filter(e=>1===t[e.id]);return e.concat(s)}async function main(){var e={init:function(e){this.game=document.querySelector(".game"),this.modal=document.querySelector(".modal"),this.overlay=document.querySelector(".modal-overlay"),this.restartButton=document.querySelector("button.restart"),this.cardsArray=duplicateUniqueCards(e),this.shuffleCards(this.cardsArray),this.setup()},shuffleCards:function(e){this.cards=this.shuffle(e)},setup:function(){this.html=this.buildHTML(),this.game.innerHTML=this.html,this.memoryCards=document.querySelectorAll(".card"),this.paused=!1,this.guess=null,this.binding(),textFit(document.querySelectorAll(".front"),{multiLine:!1})},binding:function(){var e=this;this.memoryCards.forEach(function(t){t.addEventListener("click",function(){e.cardClicked.call(e,t)})}),this.restartButton.addEventListener("click",function(){e.reset.call(e)})},cardClicked:function(e){var t=e,s=t.querySelector(".inside");if(s&&!this.paused&&!s.classList.contains("matched")&&!s.classList.contains("picked")){if(s.classList.add("picked"),this.guess)if(this.guess!=t.getAttribute("data-id")||t.classList.contains("picked")){this.guess=null,this.paused=!0;var i=this;setTimeout(function(){document.querySelectorAll(".picked").forEach(function(e){e.classList.remove("picked")}),i.paused=!1},600)}else document.querySelectorAll(".picked").forEach(function(e){e.classList.add("matched")}),this.guess=null;else this.guess=t.getAttribute("data-id");document.querySelectorAll(".matched").length==document.querySelectorAll(".card").length&&this.win()}},win:function(){this.paused=!0;var e=this;setTimeout(function(){e.showModal()},1e3)},showModal:function(){this.overlay.style.display="block",this.modal.style.display="block"},hideModal:function(){this.overlay.style.display="none",this.modal.style.display="none"},reset:function(){this.hideModal(),this.shuffleCards(this.cardsArray),this.setup(),this.game.style.display="block"},shuffle:function(e){for(var t,s,i=e.length;i>0;)s=Math.floor(Math.random()*i),t=e[--i],e[i]=e[s],e[s]=t;return e},buildHTML:function(){var e="";return this.cards.forEach(function(t){const s=marked.parseInline(t.content);e+=`<div class="card" data-id="${t.id}"><div class="inside"><div class="front">${s}</div><div class="back"><img src="${backImage}" alt="" /></div></div></div>`}),e}};let t="";if(""===getURLfromHash()){t=defaultMD;const e=document.createElement("footer"),s=await getMarkdownFromURL("https://memory.forge.apps.education.fr/README.md");e.innerHTML=marked.parse(s),document.body.appendChild(e),document.body.classList.add("default")}else t=await getMarkdownFromURL(getURLfromHash());const s=parseMarkdown(t);e.init(s)}marked.use({renderer:renderer}),main();