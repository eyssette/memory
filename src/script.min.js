const backImage="assets/Blue_Question_Circle.svg",defaultMD="Coucou !\nHi !\n\n![](assets/perso_educajou.svg)\n\n![](assets/brigit_et_komit.png)\nBrigit & Komit\n";function handleURL(e,t){if(""!==e){let i=!(!t||!t.useCorsProxy);e.includes(".forge")&&(i=!1),e.startsWith("https://github.com")&&(i=!1,e=(e=e.replace("https://github.com","https://raw.githubusercontent.com")).replace("/blob/","/")),(e.startsWith("https://codimd")||e.startsWith("https://pad.numerique.gouv.fr/")||e.includes("hedgedoc")||e.includes("digipage"))&&(i=!1,e=-1===(e=e.replace("?edit","").replace("?both","").replace("?view","").replace(/#$/,"").replace(/\/$/,"")).indexOf("download")?e+"/download":e),!e.includes("framapad")&&!e.includes("digidoc")||e.endsWith("/export/txt")||(i=!1,e=e.replace(/\?.*/,"")+"/export/txt"),e=i?"https://corsproxy.io/?url="+e:e}return e}function getMarkdownFromURL(e){return fetch(e).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()}).catch(e=>(console.error("There has been a problem with your fetch operation:",e),defaultMD))}function getURLfromHash(){return handleURL(window.location.hash.substring(1))||""}const renderer={link(e,t,i){return marked.Renderer.prototype.link.call(this,e,t,i).replace("<a","<a target='_blank' rel='noreferrer' ")}};function parseMarkdown(e){const t=e.match(/^# (.*)/),i=t?t[1].trim():null,n=e.match(/^>\s*(.*)/gm),r=n?n.join("\n").trim():null,s=Math.max(t?e.indexOf(t[0])+t[0].length:0,n?e.indexOf(r)+r.length:0),o=e.slice(s).match(/^\s*\n*/),a=o?s+o[0].length:s,d=e.slice(a).replace(/\n\n+/g,"\n\n").trim().split("\n\n"),c=[];return d.forEach((e,t)=>{if(e.includes("\n")){const i=e.split("\n");c.push({content:i[0],id:t}),c.push({content:i[1],id:t})}else c.push({content:e,id:t})}),{cards:c,title:i,blockquote:r}}function duplicateUniqueCards(e){const t=e.reduce((e,t)=>(e[t.id]=(e[t.id]||0)+1,e),{}),i=e.filter(e=>1===t[e.id]);return e.concat(i)}function redirectToUrl(e,t=window.location.origin){const i=e.value.trim();if(t=e.getAttribute("data-base-url")?"https://"+e.getAttribute("data-base-url"):t,i){const e=t+`#${i}`;window.open(e,"_blank")}else alert("Veuillez entrer une URL valide.")}function addRedirectionToOnlineMarkdown(e){return e.replace("\x3c!--INPUT_MARKDOWN--\x3e",'<label for="redirect">Copiez ici le lien vers votre fichier, puis cliquer sur ‚ÄúOK‚Äù pour ouvrir votre Memory :</label>\n<input type="url" id="redirect" class="redirect-input" placeholder="Votre URL"> <button  class="redirect-button" data-input-id="redirect" >OK</button>')}let sound;async function main(){var e={init:function(e){this.game=document.querySelector(".game"),this.modal=document.querySelector(".modal"),this.overlay=document.querySelector(".modal-overlay"),this.restartButton=document.querySelector("button.restart"),this.cardsArray=duplicateUniqueCards(e),this.shuffleCards(this.cardsArray),this.setup()},shuffleCards:function(e){this.cards=this.shuffle(e)},setup:function(){this.html=this.buildHTML(),this.game.innerHTML=this.html,this.memoryCards=document.querySelectorAll(".card"),this.paused=!1,this.guess=null,this.binding(),textFit(document.querySelectorAll(".front"),{multiLine:!1})},binding:function(){var e=this;this.memoryCards.forEach(function(t){t.addEventListener("click",function(){e.cardClicked.call(e,t)})}),this.restartButton.addEventListener("click",function(){e.reset.call(e)})},cardClicked:function(e){var t=e,i=t.querySelector(".inside");const n=i.querySelector("div[data-audio-src]");if(sound&&(sound.pause(),sound.currentTime=0),n&&(sound=new Audio(n.getAttribute("data-audio-src"))).play(),i&&!this.paused&&!i.classList.contains("matched")&&!i.classList.contains("picked")){if(i.classList.add("picked"),this.guess)if(this.guess!=t.getAttribute("data-id")||t.classList.contains("picked")){this.guess=null,this.paused=!0;var r=this;setTimeout(function(){document.querySelectorAll(".picked").forEach(function(e){e.classList.remove("picked")}),r.paused=!1},600)}else document.querySelectorAll(".picked").forEach(function(e){e.classList.add("matched")}),this.guess=null;else this.guess=t.getAttribute("data-id");document.querySelectorAll(".matched").length==document.querySelectorAll(".card").length&&this.win()}},win:function(){this.paused=!0;var e=this;setTimeout(function(){e.showModal()},1e3)},showModal:function(){this.overlay.style.display="block",this.modal.style.display="block"},hideModal:function(){this.overlay.style.display="none",this.modal.style.display="none"},reset:function(){this.hideModal(),this.shuffleCards(this.cardsArray),this.setup(),this.game.style.display="block"},shuffle:function(e){for(var t,i,n=e.length;n>0;)i=Math.floor(Math.random()*n),t=e[--n],e[n]=e[i],e[i]=t;return e},buildHTML:function(){var e="";return this.cards.forEach(function(t){let i="";if(t.content.startsWith("audio:")){i=`<div data-audio-src="${t.content.replace("audio:","").trim()}">üîä</div>`}else i=marked.parseInline(t.content);e+=`<div class="card" data-id="${t.id}"><div class="inside"><div class="front">${i}</div><div class="back"><img src="${backImage}" alt="" /></div></div></div>`}),e}};let t="";if(""===getURLfromHash()){t=defaultMD;const e=document.createElement("footer"),i=await getMarkdownFromURL("README.md"),n=marked.parse(i);e.innerHTML=addRedirectionToOnlineMarkdown(n);const r=new MutationObserver(()=>{const e=document.querySelector("button.redirect-button"),t=document.querySelector("input.redirect-input");e&&t&&(e.addEventListener("click",()=>redirectToUrl(t)),t.addEventListener("keydown",e=>{"Enter"===e.key&&redirectToUrl(t)}),r.disconnect())});r.observe(document.body,{childList:!0,subtree:!0}),document.body.appendChild(e),document.body.classList.add("default")}else t=await getMarkdownFromURL(getURLfromHash());const i=parseMarkdown(t),n=i.cards;if(i.title){document.title=i.title;const e=document.createElement("h1");e.textContent=i.title,document.body.insertBefore(e,document.body.firstChild)}if(i.blockquote){const e=document.createElement("div");e.className="instructions",e.innerHTML=marked.parse(i.blockquote);const t=document.querySelector("h1");t?t.insertAdjacentElement("afterend",e):document.body.insertBefore(e,document.body.firstChild)}e.init(n)}marked.use({renderer:renderer}),main();