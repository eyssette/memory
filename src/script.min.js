const backImage="assets/Blue_Question_Circle.svg",defaultMD="Coucou !\nHi !\n\n![](assets/perso_educajou.svg)\n\n![](assets/brigit_et_komit.png)\nBrigit & Komit\n";function handleURL(e,t){if(""!==e){let n=!(!t||!t.useCorsProxy);e.includes(".forge")&&(n=!1),e.startsWith("https://github.com")&&(n=!1,e=(e=e.replace("https://github.com","https://raw.githubusercontent.com")).replace("/blob/","/")),(e.startsWith("https://codimd")||e.startsWith("https://pad.numerique.gouv.fr/")||e.includes("hedgedoc")||e.includes("digipage"))&&(n=!1,e=-1===(e=e.replace("?edit","").replace("?both","").replace("?view","").replace(/#$/,"").replace(/\/$/,"")).indexOf("download")?e+"/download":e),!e.includes("framapad")&&!e.includes("digidoc")||e.endsWith("/export/txt")||(n=!1,e=e.replace(/\?.*/,"")+"/export/txt"),e=n?"https://corsproxy.io/?url="+e:e}return e}function getMarkdownFromURL(e){return fetch(e).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()}).catch(e=>(console.error("There has been a problem with your fetch operation:",e),defaultMD))}function getURLfromHash(){return handleURL(window.location.hash.substring(1))||""}const renderer={link(e,t,n){return marked.Renderer.prototype.link.call(this,e,t,n).replace("<a","<a target='_blank' rel='noreferrer' ")}};function parseMarkdown(e){const t=e.match(/^# (.*)/),n=t?t[1].trim():null,s=e.match(/^>\s*(.*)/gm),i=s?s.join("\n").trim():null;console.log(i);const r=Math.max(t?e.indexOf(t[0])+t[0].length:0,s?e.indexOf(i)+i.length:0),o=e.slice(r).match(/^\s*\n*/),a=o?r+o[0].length:r,c=e.slice(a).replace(/\n\n+/g,"\n\n").trim().split("\n\n"),d=[];return c.forEach((e,t)=>{if(e.includes("\n")){const n=e.split("\n");d.push({content:n[0],id:t}),d.push({content:n[1],id:t})}else d.push({content:e,id:t})}),{cards:d,title:n,blockquote:i}}function duplicateUniqueCards(e){const t=e.reduce((e,t)=>(e[t.id]=(e[t.id]||0)+1,e),{}),n=e.filter(e=>1===t[e.id]);return e.concat(n)}async function main(){var e={init:function(e){this.game=document.querySelector(".game"),this.modal=document.querySelector(".modal"),this.overlay=document.querySelector(".modal-overlay"),this.restartButton=document.querySelector("button.restart"),this.cardsArray=duplicateUniqueCards(e),this.shuffleCards(this.cardsArray),this.setup()},shuffleCards:function(e){this.cards=this.shuffle(e)},setup:function(){this.html=this.buildHTML(),this.game.innerHTML=this.html,this.memoryCards=document.querySelectorAll(".card"),this.paused=!1,this.guess=null,this.binding(),textFit(document.querySelectorAll(".front"),{multiLine:!1})},binding:function(){var e=this;this.memoryCards.forEach(function(t){t.addEventListener("click",function(){e.cardClicked.call(e,t)})}),this.restartButton.addEventListener("click",function(){e.reset.call(e)})},cardClicked:function(e){var t=e,n=t.querySelector(".inside");if(n&&!this.paused&&!n.classList.contains("matched")&&!n.classList.contains("picked")){if(n.classList.add("picked"),this.guess)if(this.guess!=t.getAttribute("data-id")||t.classList.contains("picked")){this.guess=null,this.paused=!0;var s=this;setTimeout(function(){document.querySelectorAll(".picked").forEach(function(e){e.classList.remove("picked")}),s.paused=!1},600)}else document.querySelectorAll(".picked").forEach(function(e){e.classList.add("matched")}),this.guess=null;else this.guess=t.getAttribute("data-id");document.querySelectorAll(".matched").length==document.querySelectorAll(".card").length&&this.win()}},win:function(){this.paused=!0;var e=this;setTimeout(function(){e.showModal()},1e3)},showModal:function(){this.overlay.style.display="block",this.modal.style.display="block"},hideModal:function(){this.overlay.style.display="none",this.modal.style.display="none"},reset:function(){this.hideModal(),this.shuffleCards(this.cardsArray),this.setup(),this.game.style.display="block"},shuffle:function(e){for(var t,n,s=e.length;s>0;)n=Math.floor(Math.random()*s),t=e[--s],e[s]=e[n],e[n]=t;return e},buildHTML:function(){var e="";return this.cards.forEach(function(t){const n=marked.parseInline(t.content);e+=`<div class="card" data-id="${t.id}"><div class="inside"><div class="front">${n}</div><div class="back"><img src="${backImage}" alt="" /></div></div></div>`}),e}};let t="";if(""===getURLfromHash()){t=defaultMD;const e=document.createElement("footer"),n=await getMarkdownFromURL("https://memory.forge.apps.education.fr/README.md");e.innerHTML=marked.parse(n),document.body.appendChild(e),document.body.classList.add("default")}else t=await getMarkdownFromURL(getURLfromHash());const n=parseMarkdown(t),s=n.cards;if(n.title){document.title=n.title;const e=document.createElement("h1");e.textContent=n.title,document.body.insertBefore(e,document.body.firstChild)}if(n.blockquote){const e=document.createElement("div");e.className="instructions",e.innerHTML=marked.parse(n.blockquote);const t=document.querySelector("h1");t?t.insertAdjacentElement("afterend",e):document.body.insertBefore(e,document.body.firstChild)}e.init(s)}marked.use({renderer:renderer}),main();