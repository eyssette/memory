const backImage="assets/Blue_Question_Circle.svg",defaultMD="Coucou !\nHi !\n\n![](assets/perso_educajou.svg)\n\n![](assets/brigit_et_komit.png)\nBrigit & Komit\n";function handleURL(e,t){if(""!==e){let r=!(!t||!t.useCorsProxy);e.includes(".forge")&&(r=!1),e.startsWith("https://github.com")&&(r=!1,e=(e=e.replace("https://github.com","https://raw.githubusercontent.com")).replace("/blob/","/")),(e.startsWith("https://codimd")||e.startsWith("https://pad.numerique.gouv.fr/")||e.includes("hedgedoc")||e.includes("digipage"))&&(r=!1,e=-1===(e=e.replace("?edit","").replace("?both","").replace("?view","").replace(/#$/,"").replace(/\/$/,"")).indexOf("download")?e+"/download":e),!e.includes("framapad")&&!e.includes("digidoc")||e.endsWith("/export/txt")||(r=!1,e=e.replace(/\?.*/,"")+"/export/txt"),e=r?"https://corsproxy.io/?url="+e:e}return e}function getMarkdownFromURL(e){return fetch(e).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()}).catch(e=>(console.error("There has been a problem with your fetch operation:",e),defaultMD))}function getURLfromHash(){return handleURL(window.location.hash.substring(1))||""}const renderer={link(e,t,r){return marked.Renderer.prototype.link.call(this,e,t,r).replace("<a","<a target='_blank' rel='noreferrer' ")}};function parseMarkdown(e){const t=e.match(/^# (.*)/),r=t?t[1].trim():null,n=e.match(/^>\s*(.*)/gm),i=n?n.join("\n").trim():null,o=Math.max(t?e.indexOf(t[0])+t[0].length:0,n?e.indexOf(i)+i.length:0),s=e.slice(o).match(/^\s*\n*/),c=s?o+s[0].length:o,d=e.slice(c).replace(/\n\n+/g,"\n\n").trim().split("\n\n"),a=[];return d.forEach((e,t)=>{if(e.includes("\n")){const r=e.split("\n");a.push({content:r[0],id:t}),a.push({content:r[1],id:t})}else a.push({content:e,id:t})}),{cards:a,title:r,blockquote:i}}function duplicateUniqueCards(e){const t=e.reduce((e,t)=>(e[t.id]=(e[t.id]||0)+1,e),{}),r=e.filter(e=>1===t[e.id]);return e.concat(r)}function redirectToUrl(e,t=window.location.origin){const r=e.value.trim();if(t=e.getAttribute("data-base-url")?"https://"+e.getAttribute("data-base-url"):t,r){const e=t+`#${r}`;window.open(e,"_blank")}else alert("Veuillez entrer une URL valide.")}function addRedirectionToOnlineMarkdown(e){return e.replace("\x3c!--INPUT_MARKDOWN--\x3e",'<label for="redirect">Copiez ici le lien vers votre fichier, puis cliquer sur ‚ÄúOK‚Äù pour ouvrir votre Memory :</label>\n<input type="url" id="redirect" class="redirect-input" placeholder="Votre URL"> <button  class="redirect-button" data-input-id="redirect" >OK</button>').replace("\x3c!--BUTTON_OPEN_EDITOR--\x3e",'<button class="openEditor">Ouvrir l\'√©diteur en ligne</button>')}let sound;marked.use({renderer:renderer});var Memory={init:function(e){const t=parseMarkdown(e),r=t.cards;if(t.title){document.title=t.title;const e=document.querySelector("body > h1")?document.querySelector("body > h1"):document.createElement("h1");e.textContent=t.title,document.body.insertBefore(e,document.querySelector(".wrap"))}else{const e=document.querySelector("body > h1");e&&e.remove()}if(t.blockquote){const e=document.querySelector(".instructions")?document.querySelector(".instructions"):document.createElement("div");e.className="instructions",e.innerHTML=marked.parse(t.blockquote);const r=document.querySelector("body > h1");r?r.insertAdjacentElement("afterend",e):document.body.insertBefore(e,document.querySelector(".wrap"))}else{const e=document.querySelector(".instructions");e&&e.remove()}this.game=document.querySelector(".game"),this.modal=document.querySelector(".modal"),this.overlay=document.querySelector(".modal-overlay"),this.restartButton=document.querySelector("button.restart"),this.cardsArray=duplicateUniqueCards(r),this.shuffleCards(this.cardsArray),this.setup()},shuffleCards:function(e){document.querySelector(".editor-wrapper")&&!document.body.classList.contains("mouseOutEditor")?this.cards=e:this.cards=this.shuffle(e)},setup:function(){this.html=this.buildHTML(),this.game.innerHTML=this.html,this.memoryCards=document.querySelectorAll(".card"),this.paused=!1,this.guess=null,this.binding(),textFit(document.querySelectorAll(".front"),{multiLine:!1})},binding:function(){var e=this;this.memoryCards.forEach(function(t){t.addEventListener("click",function(){e.cardClicked.call(e,t)})}),this.restartButton.addEventListener("click",function(){e.reset.call(e)})},cardClicked:function(e){var t=e,r=t.querySelector(".inside");const n=r.querySelector("div[data-audio-src]");if(sound&&(sound.pause(),sound.currentTime=0),n&&(sound=new Audio(n.getAttribute("data-audio-src")),sound.play()),r&&!this.paused&&!r.classList.contains("matched")&&!r.classList.contains("picked")){if(r.classList.add("picked"),this.guess)if(this.guess!=t.getAttribute("data-id")||t.classList.contains("picked")){this.guess=null,this.paused=!0;var i=this;setTimeout(function(){document.querySelectorAll(".picked").forEach(function(e){e.classList.remove("picked")}),i.paused=!1},600)}else document.querySelectorAll(".picked").forEach(function(e){e.classList.add("matched")}),this.guess=null;else this.guess=t.getAttribute("data-id");document.querySelectorAll(".matched").length==document.querySelectorAll(".card").length&&this.win()}},win:function(){this.paused=!0;var e=this;setTimeout(function(){e.showModal()},1e3)},showModal:function(){this.overlay.style.display="block",this.modal.style.display="block"},hideModal:function(){this.overlay.style.display="none",this.modal.style.display="none"},reset:function(){this.hideModal(),this.shuffleCards(this.cardsArray),this.setup(),this.game.style.display="block"},shuffle:function(e){for(var t,r,n=e.length;n>0;)r=Math.floor(Math.random()*n),t=e[--n],e[n]=e[r],e[r]=t;return e},buildHTML:function(){var e="";return this.cards.forEach(function(t){let r="";if(t.content.startsWith("audio:")){r=`<div data-audio-src="${t.content.replace("audio:","").trim()}">üîä</div>`}else r=marked.parseInline(t.content);e+=`<div class="card" data-id="${t.id}"><div class="inside"><div class="front">${r}</div><div class="back"><img src="${backImage}" alt="" /></div></div></div>`}),e}};async function main(){let e="";if(""===getURLfromHash()){e=defaultMD;const t=document.createElement("footer"),r=await getMarkdownFromURL("README.md"),n=marked.parse(r);t.innerHTML=addRedirectionToOnlineMarkdown(n);const i=new MutationObserver(()=>{const e=document.querySelector("button.redirect-button"),t=document.querySelector("input.redirect-input");e&&t&&(e.addEventListener("click",()=>redirectToUrl(t)),t.addEventListener("keydown",e=>{"Enter"===e.key&&redirectToUrl(t)}),i.disconnect())});i.observe(document.body,{childList:!0,subtree:!0}),document.body.appendChild(t),document.body.classList.add("default");document.querySelector("button.openEditor").addEventListener("click",()=>{if(window.innerWidth<600||window.innerHeight<500)return void alert("L'√©diteur Markdown n'est pas disponible sur les petits √©crans. Merci d'utiliser un ordinateur ou une tablette en mode paysage.");document.body.classList.toggle("editMode");const e=document.querySelector(".editor-wrapper");if(null===e)initMarkdownEditor();else{e.style.display="block";document.querySelector(".close-editor-button").style.display="block";const t=document.querySelector("footer");t.style.display="none",t.style.top="25vh";const r=document.querySelector(".editor").textContent;Memory.init(r)}})}else e=await getMarkdownFromURL(getURLfromHash());Memory.init(e)}main();