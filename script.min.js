const backImage="assets/Blue_Question_Circle.svg",defaultMD="\n# Memory\n\nCoucou !\nHi !\n\n![](assets/perso_educajou.svg)\n\n![](assets/brigit_et_komit.png)\nBrigit & Komit\n";function handleURL(t,e){if(""!==t){let s=!(!e||!e.useCorsProxy);t.includes(".forge")&&(s=!1),t.startsWith("https://github.com")&&(s=!1,t=(t=t.replace("https://github.com","https://raw.githubusercontent.com")).replace("/blob/","/")),(t.startsWith("https://codimd")||t.startsWith("https://pad.numerique.gouv.fr/")||t.includes("hedgedoc")||t.includes("digipage"))&&(s=!1,t=-1===(t=t.replace("?edit","").replace("?both","").replace("?view","").replace(/#$/,"").replace(/\/$/,"")).indexOf("download")?t+"/download":t),!t.includes("framapad")&&!t.includes("digidoc")||t.endsWith("/export/txt")||(s=!1,t=t.replace(/\?.*/,"")+"/export/txt"),t=s?"https://corsproxy.io/?url="+t:t}return t}function getMarkdownFromURL(t){return fetch(t).then((t=>{if(!t.ok)throw new Error("Network response was not ok");return t.text()})).catch((t=>defaultMD))}function getURLfromHash(){return handleURL(window.location.hash.substring(1))||""}function parseMarkdown(t){const e=t.replace(/#.*/g,"").replace(/\n\n+/g,"\n\n").trim().split("\n\n"),s=[];return e.forEach(((t,e)=>{if(t.includes("\n")){const i=t.split("\n");s.push({content:i[0],id:e}),s.push({content:i[1],id:e})}else s.push({content:t,id:e})})),s}function duplicateUniqueCards(t){const e=t.reduce(((t,e)=>(t[e.id]=(t[e.id]||0)+1,t)),{}),s=t.filter((t=>1===e[t.id]));return t.concat(s)}async function main(){var t={init:function(t){this.game=document.querySelector(".game"),this.modal=document.querySelector(".modal"),this.overlay=document.querySelector(".modal-overlay"),this.restartButton=document.querySelector("button.restart"),this.cardsArray=duplicateUniqueCards(t),this.shuffleCards(this.cardsArray),this.setup()},shuffleCards:function(t){this.cards=this.shuffle(t)},setup:function(){this.html=this.buildHTML(),this.game.innerHTML=this.html,this.memoryCards=document.querySelectorAll(".card"),this.paused=!1,this.guess=null,this.binding(),textFit(document.querySelectorAll(".front"),{multiLine:!1})},binding:function(){var t=this;this.memoryCards.forEach((function(e){e.addEventListener("click",(function(){t.cardClicked.call(t,e)}))})),this.restartButton.addEventListener("click",(function(){t.reset.call(t)}))},cardClicked:function(t){var e=t,s=e.querySelector(".inside");if(s&&!this.paused&&!s.classList.contains("matched")&&!s.classList.contains("picked")){if(s.classList.add("picked"),this.guess)if(this.guess!=e.getAttribute("data-id")||e.classList.contains("picked")){this.guess=null,this.paused=!0;var i=this;setTimeout((function(){document.querySelectorAll(".picked").forEach((function(t){t.classList.remove("picked")})),i.paused=!1}),600)}else document.querySelectorAll(".picked").forEach((function(t){t.classList.add("matched")})),this.guess=null;else this.guess=e.getAttribute("data-id");document.querySelectorAll(".matched").length==document.querySelectorAll(".card").length&&this.win()}},win:function(){this.paused=!0;var t=this;setTimeout((function(){t.showModal()}),1e3)},showModal:function(){this.overlay.style.display="block",this.modal.style.display="block"},hideModal:function(){this.overlay.style.display="none",this.modal.style.display="none"},reset:function(){this.hideModal(),this.shuffleCards(this.cardsArray),this.setup(),this.game.style.display="block"},shuffle:function(t){for(var e,s,i=t.length;i>0;)s=Math.floor(Math.random()*i),e=t[--i],t[i]=t[s],t[s]=e;return t},buildHTML:function(){var t="";return this.cards.forEach((function(e){const s=marked.parseInline(e.content);t+=`<div class="card" data-id="${e.id}"><div class="inside"><div class="front">${s}</div><div class="back"><img src="${backImage}" alt="" /></div></div></div>`})),t}};let e="";if(""===getURLfromHash()){e=defaultMD;const t=document.createElement("footer"),s=await getMarkdownFromURL("https://memory.forge.apps.education.fr/README.md");t.innerHTML=marked.parse(s),document.body.appendChild(t)}else e=await getMarkdownFromURL(getURLfromHash());const s=parseMarkdown(e);t.init(s)}main();